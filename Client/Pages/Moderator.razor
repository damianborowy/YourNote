@page "/moderator"
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider ApiAuthenticationStateProvider
@inject HttpClient Http
@using YourNote.Shared.Models

@if (IsPermitted)
{
    <h1>Panel moderatorski</h1>
    <ul>
        @foreach (var user in users)
        {
            <li>
                <a href="/notes/@user.Id">@user.Username</a>
            </li>
        }
    </ul>
}
else
{
    <p>
        Nie posiadasz wystarczających uprawnień by wyświetlić tą stronę.
    </p>
}

@code {
    bool IsPermitted { get; set; } = false;
    IEnumerable<User> users = Array.Empty<User>();

    protected override async Task OnInitializedAsync()
    {
        var authState = await ApiAuthenticationStateProvider.GetAuthenticationStateAsync();
        var role = ClaimsParser.Select(authState, "role");

        if (role.Equals("Moderator")) IsPermitted = true;
        else return;

        users = await Http.GetJsonAsync<User[]>("/api/users");
    }
}